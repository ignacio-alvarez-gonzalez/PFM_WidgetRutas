{"version":3,"sources":["../../../widgets/PFM_Ruta/Widget.js"],"names":["ocultar","esto","vista","document","getElementById","style","display","flexDirection","ocultarPro","bueno","malo1","malo2","malo3","malo4","vbueno","vmalo1","vmalo2","vmalo3","vmalo4","define","declare","BaseWidget","SpatialReference","FeatureSet","FeatureLayer","RouteTask","RouteParameters","RouteResult","NATypes","GeometryService","BufferParameters","QueryTask","Query","Draw","Point","SimpleFillSymbol","SimpleLineSymbol","SimpleMarkerSymbol","Graphic","Color","Search","on","baseClass","postCreate","inherited","arguments","console","log","onOpen","miMapa","map","capaPuntosRecarga","itemInfo","itemData","operationalLayers","layerObject","hide","urlServicioRutas","urlTablaDatosVehiculos","puntoInicio","ubicacionInicio","puntoFinal","ubicacionFinal","miSimboloUbicacion","STYLE_SQUARE","STYLE_SOLID","graphics","clear","setDefinitionExpression","dojo","byId","marcaCoche","value","innerHTML","tareaConsultaVehiculos","consultaVehiculos","returnGeometry","outFields","orderByFields","where","execute","resultados","opcion","createElement","text","add","i","features","length","attributes","BATERIA_kwh","MODELO","remove","herramientaDibujo","activate","POINT","evento","geometry","deactivate","miBuscadorInicio","enableInfoWindow","autoNavigate","startup","eventoBuscadorOrigen","result","feature","miBuscadorFinal","eventoBuscadorDestino","bateriaDisponible","porcentajeDisponible","entidades","push","ubicaciones","tareaRuta","parametrosRuta","accumulateAttributes","preserveFirstStop","preserveLastStop","restrictUTurns","UTurn","AT_DEAD_ENDS_ONLY","outputLines","OutputLine","TRUE_SHAPE_WITH_MEASURE","stops","outSpatialReference","spatialReference","solve","rutaPrimerCaso","routeResults","route","simboloRuta","Total_ConsumoKWh","setSymbol","setExtent","getExtent","Math","round","Total_Length","Total_Tiempo_coche","graficoAI","listaTipoConector","listaTipoOperador","checked","forEach","tipoConector","pop","tipoOperador","tipoConectorSeleccionado","expresionesTipoConector","conector","expresionDefinicionConectores","expresion","tipoOperadorSeleccionado","expresionesTipoOperador","expresionDefinicionOperadores","operador","expresionDefinicion","servicioGeometria","parametrosAI","geometries","distances","unit","UNIT_KILOMETER","buffer","eventoBuffer","show","simboloAI","STYLE_NULL","STYLE_DASHED","parametro","consultaPdR","queryFeatures","miTareaDeConsulta","url","resultado","indices","tareaRutaEvaluadora","entidad","entidadEvaluada","puntoEvaluado","entidadesRutaEvaluadora","ubicacionesRutaEvaluadora","parametrosRutaEvaluadora","eventoRutaEvaluadora","rutaEvaluadora","objectid","expresiones","idPunto","expresionDefinicionGeometria","herramientaSeleccion","EXTENT","eventoSeleccion","consultaSeleccion","simboloSeleccion","setSelectionSymbol","selectFeatures","puntoSeleccionado","getSelectedFeatures","entidadesSegundaRuta","ubicacionIntermedia","ubicacionIntermedia1","ubicacionIntermedia2","ubicacionIntermedia3","ubicacionesSegundaRuta","tareaSegundaRuta","parametrosSegundaRuta","rutaSegundoCaso","onClose","bateria","clearSelection"],"mappings":"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","file":"Widget.js","sourcesContent":["function ocultar(esto) {\r\n  vista=document.getElementById(esto).style.display;\r\n  if (vista=='none')\r\n    vista='flex';\r\n  else\r\n    vista='none';\r\n\r\n  document.getElementById(esto).style.display = vista;\r\n  document.getElementById(esto).style.flexDirection = 'column';\r\n   \r\n}\r\nfunction ocultarPro(bueno,malo1,malo2,malo3,malo4) {\r\n  var vbueno =document.getElementById(bueno).style.display;\r\n  var vmalo1 =document.getElementById(malo1).style.display;\r\n  var vmalo2 =document.getElementById(malo2).style.display;\r\n  var vmalo3 =document.getElementById(malo3).style.display;\r\n  var vmalo4 =document.getElementById(malo4).style.display;\r\n  if (vbueno == 'none'){\r\n    vbueno ='block';\r\n    vmalo1 ='none';\r\n    vmalo2 ='none';\r\n    vmalo3 ='none';\r\n    vmalo4 ='none';\r\n  } else {\r\n    vbueno='none'\r\n  }\r\n    \r\n  \r\n  document.getElementById(bueno).style.display = vbueno;\r\n  document.getElementById(malo1).style.display = vmalo1;\r\n  document.getElementById(malo2).style.display = vmalo2;\r\n  document.getElementById(malo3).style.display = vmalo3;\r\n  document.getElementById(malo4).style.display = vmalo4;\r\n  \r\n\r\n}\r\n\r\n\r\ndefine([\r\n  'dojo/_base/declare',\r\n  'jimu/BaseWidget',\r\n\r\n  \"esri/SpatialReference\",\r\n  \"esri/tasks/FeatureSet\",\r\n  \"esri/layers/FeatureLayer\",\r\n\r\n  \"esri/tasks/RouteTask\",\r\n  \"esri/tasks/RouteParameters\",\r\n  \"esri/tasks/RouteResult\",\r\n  \"esri/tasks/NATypes\",\r\n\r\n  \"esri/tasks/GeometryService\",\r\n  \"esri/tasks/BufferParameters\",\r\n\r\n  \"esri/tasks/QueryTask\",\r\n  \"esri/tasks/query\",\r\n\r\n  \"esri/toolbars/draw\",\r\n  \"esri/geometry/Point\",\r\n  \"esri/symbols/SimpleFillSymbol\",\r\n  \"esri/symbols/SimpleLineSymbol\",\r\n  \"esri/symbols/SimpleMarkerSymbol\",\r\n  \"esri/graphic\", \r\n  \"esri/Color\",\r\n\r\n  \"esri/dijit/Search\",\r\n\r\n  \"dojo/on\"\r\n], function(\r\n  declare, \r\n  BaseWidget,\r\n\r\n  SpatialReference,\r\n  FeatureSet,\r\n  FeatureLayer,\r\n\r\n  RouteTask,\r\n  RouteParameters,\r\n  RouteResult,\r\n  NATypes,\r\n\r\n  GeometryService,\r\n  BufferParameters,\r\n\r\n  QueryTask,\r\n  Query,\r\n\r\n  Draw,\r\n  Point,\r\n  SimpleFillSymbol,\r\n  SimpleLineSymbol,\r\n  SimpleMarkerSymbol,\r\n  Graphic,\r\n  Color,\r\n\r\n  Search,\r\n\r\n  on\r\n  ) {\r\n\r\n  return declare([BaseWidget], {\r\n\r\n    baseClass: 'pfm-ruta',\r\n\r\n    postCreate: function() {\r\n      this.inherited(arguments);\r\n      console.log('PFM_Ruta::postCreate');\r\n    },\r\n\r\n    // startup: function() {\r\n    //   this.inherited(arguments);\r\n    //   console.log('PFM_Ruta::startup');\r\n    // },\r\n\r\n    onOpen: function(){\r\n      console.log('PFM_Ruta::onOpen');\r\n\r\n      // SE GUARDAN LAS PRINCIPALES VARIABLES QUE SE VAN A USAR:\r\n      // SE ALMACENAN LAS RUTAS DE LOS PRINCIPALES SERVICIOS QUE SE VAN A USAR:\r\n\r\n      var miMapa = this.map;\r\n      console.log(\"El mapa: \", miMapa);\r\n\r\n      var capaPuntosRecarga = this.map.itemInfo.itemData.operationalLayers[0];\r\n      console.log(\"La capa de puntos de recarga: \", capaPuntosRecarga);\r\n      capaPuntosRecarga.layerObject.hide();\r\n\r\n      var urlServicioRutas = \"https://localhost:6443/arcgis/rest/services/PFM/20210403_pruebaPublicarServiciosRutas_v2/NAServer/Route\";\r\n      var urlTablaDatosVehiculos = \"https://services3.arcgis.com/OTL4fBaJCey9GRSL/ArcGIS/rest/services/TablaDatosVehiculos/FeatureServer/0\";\r\n\r\n      var puntoInicio;\r\n      var ubicacionInicio;\r\n      var puntoFinal;\r\n      var ubicacionFinal;\r\n\r\n      var miSimboloUbicacion = new SimpleMarkerSymbol(\r\n        SimpleMarkerSymbol.STYLE_SQUARE, \r\n        10,\r\n        new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n        new Color([255,255,255])\r\n      );\r\n      \r\n      // AL ABRIR EL WIDGET SE BORRA TODO LO DIBUJADO EN LA CAPA GRÁFICOS ANTERIORMENTE Y SE ELIMINAN FILTROS PREVIOS:\r\n      miMapa.graphics.clear();\r\n      capaPuntosRecarga.layerObject.setDefinitionExpression(null);\r\n\r\n      // AL CAMBIAR EL SELECTOR DE MARCA DE COCHE SE LA LANZA LA FUNCIÓN QUE ESCRIBE EN EL HTML LA SELECCION DE MODELOS DE ESA MARCA:\r\n      on(dojo.byId(\"selectorMarca\"), \"change\", function(){\r\n\r\n        var marcaCoche = dojo.byId(\"selectorMarca\").value;\r\n\r\n        if (marcaCoche == \"Ninguno\") return;\r\n\r\n        dojo.byId(\"selectorModelo\").innerHTML = \"\";\r\n\r\n        var tareaConsultaVehiculos = new QueryTask(urlTablaDatosVehiculos);\r\n\r\n        var consultaVehiculos = new Query();\r\n        consultaVehiculos.returnGeometry = false;\r\n        consultaVehiculos.outFields = [\"MODELO\", \"BATERIA_kwh\"];\r\n        consultaVehiculos.orderByFields = [\"MODELO\"];\r\n        consultaVehiculos.where = \"MARCA = '\" + marcaCoche + \"'\";\r\n\r\n        tareaConsultaVehiculos.execute(consultaVehiculos, function(resultados) {\r\n\r\n          var opcion = document.createElement(\"option\");\r\n          opcion.value = \"Ninguno\";\r\n          opcion.text = \"Seleccione un modelo:\";\r\n          dojo.byId(\"selectorModelo\").add(opcion);\r\n\r\n          for (var i = 0; i < resultados.features.length; i++) {\r\n\r\n              opcion = document.createElement(\"option\");\r\n              opcion.value = resultados.features[i].attributes.BATERIA_kwh;\r\n              opcion.text = resultados.features[i].attributes.MODELO;\r\n              dojo.byId(\"selectorModelo\").add(opcion);\r\n          }\r\n        });\r\n\r\n      });\r\n\r\n      // AL CAMBIAR EL SELECTOR DE MODELO DE COCHE, SE LANZA LA FUNCIÓN QUE LANZA LA ALTERNATIVA EN CASO DE QUE NO SE DISPONGAN DATOS DE LA BATERÍA:\r\n      on(dojo.byId(\"selectorModelo\"), \"change\", function(){\r\n\r\n        console.log(\"La batería: \", dojo.byId(\"selectorModelo\").value);\r\n\r\n        if(dojo.byId(\"selectorModelo\").value == 0) {\r\n          dojo.byId(\"errorBateria\").innerHTML = \"Aún no disponemos de los datos de capacidad de batería de su vehículo. Por favor, introduzcalos manualmente.\";\r\n          dojo.byId(\"datosBateria\").style.display = \"block\";\r\n        } else {\r\n          dojo.byId(\"errorBateria\").innerHTML = \"\";\r\n        };\r\n\r\n      });\r\n\r\n      // AL CAMBIAR EL VALOR DEL PORCENTAJE DE LA BATERÍA, SE LANZA LA FUNCIÓN QUE ESCRIBE EL ERROR DE INTRODUCIR UN VALOR VÁLIDO:\r\n      on(dojo.byId(\"porcentaje\"), \"change\", function(){\r\n\r\n        if (dojo.byId(\"porcentaje\").value == 0) {\r\n          dojo.byId(\"errorPorcentaje\").innerHTML = \"El porcentaje de carga de la batería tiene que ser mayor que 0\";\r\n        } else {\r\n          dojo.byId(\"errorPorcentaje\").innerHTML = \"\";\r\n        };\r\n\r\n      });\r\n\r\n      // AL PULSAR EN EL BOTÓN DE SELECCIONAR ORIGEN SE LANZA LA FUNCIÓN QUE CREA EL PUNTO DE INICIO Y LO DIBUJA EN EL MAPA:\r\n      on(dojo.byId(\"seleccionInicio\"), \"click\", function(){\r\n\r\n        miMapa.graphics.remove(ubicacionInicio);\r\n\r\n        var herramientaDibujo = new Draw(miMapa);\r\n        herramientaDibujo.activate(Draw.POINT);\r\n        herramientaDibujo.on(\"draw-end\", function(evento){\r\n\r\n          puntoInicio = new Point(evento.geometry);\r\n\r\n          ubicacionInicio = new Graphic(puntoInicio, miSimboloUbicacion);\r\n          miMapa.graphics.add(ubicacionInicio);\r\n\r\n          herramientaDibujo.deactivate();\r\n\r\n        });\r\n\r\n      });\r\n\r\n      // AL PULSAR EN EL BOTÓN DE SELECCIONAR DESTINO SE LANZA LA FUNCIÓN QUE CREA EL PUNTO FINAL Y LO DIBUJA EN EL MAPA:\r\n      on(dojo.byId(\"seleccionFinal\"), \"click\", function(){\r\n\r\n        miMapa.graphics.remove(ubicacionFinal);\r\n\r\n        var herramientaDibujo = new Draw(miMapa);\r\n        herramientaDibujo.activate(Draw.POINT);\r\n        herramientaDibujo.on(\"draw-end\", function(evento){\r\n\r\n          puntoFinal = new Point(evento.geometry);\r\n\r\n          ubicacionFinal = new Graphic(puntoFinal, miSimboloUbicacion);\r\n          miMapa.graphics.add(ubicacionFinal);\r\n\r\n          herramientaDibujo.deactivate();\r\n\r\n        });\r\n\r\n      });\r\n\r\n      // CREO UN BUSCADOR PARA GEOLOCALIZAR DIRECCIONES COMO ALTERNATIVA PARA CREAR EL PUNTO DE ORIGEN:\r\n      var miBuscadorInicio = new Search({map: miMapa, enableInfoWindow: false, autoNavigate: false}, \"buscadorInicio\");\r\n      miBuscadorInicio.startup();\r\n      miBuscadorInicio.on(\"select-result\", function(eventoBuscadorOrigen){\r\n\r\n        miMapa.graphics.remove(ubicacionInicio);\r\n\r\n        puntoInicio = new Point(eventoBuscadorOrigen.result.feature.geometry);\r\n\r\n        ubicacionInicio = new Graphic(puntoInicio, miSimboloUbicacion);\r\n        miMapa.graphics.add(ubicacionInicio);\r\n\r\n        miBuscadorInicio.clear();\r\n        \r\n      });\r\n      \r\n      // CREO OTRO BUSCADOR PARA GEOLOCALIZAR DIRECCIONES COMO ALTERNATIVA PARA CREAR EL PUNTO DE DESTINO:\r\n      var miBuscadorFinal = new Search({map: miMapa, enableInfoWindow: false, autoNavigate: false}, \"buscadorFinal\");\r\n      miBuscadorFinal.startup();\r\n      miBuscadorFinal.on(\"select-result\", function(eventoBuscadorDestino){\r\n\r\n        miMapa.graphics.remove(ubicacionFinal);\r\n\r\n        puntoFinal = new Point(eventoBuscadorDestino.result.feature.geometry);\r\n\r\n        ubicacionFinal = new Graphic(puntoFinal, miSimboloUbicacion);\r\n        miMapa.graphics.add(ubicacionFinal);\r\n\r\n        miBuscadorFinal.clear();\r\n        \r\n      });\r\n\r\n      // AL PULSAR EN EL BOTÓN DE CALCULAR RUTA SE LANZA LA FUNCIÓN PRINCIPAL QUE EVALUA LAS RUTAS Y DE LA QUE CUELGAN LAS SIGUIENTES FUNCIONES:\r\n      on(dojo.byId(\"calcularRuta\"), \"click\", function(){\r\n\r\n        // SE EVALUA SI SE HA SELECCIONADO CORRECTAMENTE MARCA Y MODELO DE COCHE. EN CASO DE NO HABERSE SELECCIONADO, LA FUNCIÓN PARA:\r\n        if (dojo.byId(\"selectorMarca\").value == \"Ninguno\" || dojo.byId(\"selectorModelo\").value == \"Ninguno\") {\r\n          dojo.byId(\"errorCoche\").innerHTML = \"Seleccione su marca y modelo de coche.\";\r\n          return;\r\n        };\r\n\r\n        // SE CREAN VARIABLES PARA ALMACENAR LOS DATOS DE LA BATERÍA:\r\n        var bateriaDisponible;\r\n        var porcentajeDisponible = dojo.byId(\"porcentaje\").value;\r\n\r\n        if (dojo.byId(\"selectorModelo\").value != 0) {\r\n\r\n          bateriaDisponible = dojo.byId(\"selectorModelo\").value;\r\n\r\n        } else if (dojo.byId(\"selectorModelo\").value == 0) {\r\n\r\n          if (dojo.byId(\"bateria\").value != 0) {\r\n            dojo.byId(\"errorBateria\").innerHTML = \"\";\r\n            bateriaDisponible = dojo.byId(\"bateria\").value;\r\n          } else if (dojo.byId(\"bateria\").value == 0) {\r\n            dojo.byId(\"errorBateria\").innerHTML = \"Introduzca la capacidad de su batería.\";\r\n            return;\r\n          };\r\n\r\n        };\r\n\r\n        // SE EVALUA SI SE HA SELECCIONADO CORRECTAMENTE EL ORIGEN Y EL DESTINO PARA CONTINUAR CON LA EVALUACIÓN DE LA RUTA:\r\n        if ((puntoInicio != null) && (puntoFinal != null)) {\r\n\r\n          // SE CREAN PARÁMETROS PARA RESOLVER LA PRIMERA TAREA DE RUTA:\r\n\r\n          var entidades = [];\r\n          entidades.push(ubicacionInicio);\r\n          entidades.push(ubicacionFinal);\r\n\r\n          var ubicaciones = new FeatureSet();\r\n          ubicaciones.features = entidades;\r\n\r\n          var tareaRuta = new RouteTask(urlServicioRutas);\r\n\r\n          var parametrosRuta = new RouteParameters;\r\n          parametrosRuta.accumulateAttributes = [\"ConsumoKWh\", \"Length\", \"Tiempo_coche\"];\r\n          parametrosRuta.preserveFirstStop = true;\r\n          parametrosRuta.preserveLastStop = true;\r\n          parametrosRuta.restrictUTurns = NATypes.UTurn.AT_DEAD_ENDS_ONLY;\r\n          parametrosRuta.outputLines = NATypes.OutputLine.TRUE_SHAPE_WITH_MEASURE;\r\n          parametrosRuta.stops = ubicaciones;\r\n          parametrosRuta.outSpatialReference = miMapa.spatialReference;\r\n\r\n          // SE RESUELVE LA RUTA ENTRE EL ORIGEN Y EL DESTINO:\r\n          tareaRuta.solve(parametrosRuta, function(evento){\r\n\r\n            console.log(\"Los resultados de la ruta: \", evento);\r\n            var rutaPrimerCaso = evento.routeResults[0].route;\r\n            var simboloRuta = new SimpleLineSymbol(\"solid\", new Color([0,255,0]), 4);\r\n\r\n            console.log(\"La autonomía disponible: \", (bateriaDisponible * (porcentajeDisponible/100)));\r\n\r\n            // SE EVALUA SI LA AUTONOMÍA DISPONIBLE DEL COCHE ES SUFICIENTE PARA CUBRIR EL TRAYECTO:\r\n            // EN CASO DE SER SUFICIENTE, SE DIBUJA ESA RUTA Y SE OBTIENEN LOS DATOS DEL VIAJE:\r\n            if (rutaPrimerCaso.attributes.Total_ConsumoKWh < (bateriaDisponible * (porcentajeDisponible/100))) {\r\n\r\n              rutaPrimerCaso.setSymbol(simboloRuta);\r\n              miMapa.graphics.add(rutaPrimerCaso);\r\n              miMapa.setExtent(rutaPrimerCaso.geometry.getExtent(), true);\r\n              dojo.byId(\"consumoTotal\").innerHTML = \"El consumo total del trayecto será \" + Math.round((rutaPrimerCaso.attributes.Total_ConsumoKWh)*100)/100 + \"kWh.\";\r\n              dojo.byId(\"trayectoTotal\").innerHTML = \"El trayecto recorrerá \" + Math.round((rutaPrimerCaso.attributes.Total_Length/1000)*100)/100 + \"km en \" + Math.round((rutaPrimerCaso.attributes.Total_Tiempo_coche)*100)/100 + \"horas.\";\r\n\r\n            // SI LA AUTONOMÍA NO ES SUFICIENTE, SE DESPLIEGA EL SIGUIENTE BLOQUE DE HTML PARA SOLICITAR DATOS SOBRE LA RECARGA NECESARIA:\r\n            } else {\r\n\r\n              dojo.byId(\"datosSegundoCaso\").style.display = \"block\";\r\n\r\n              var graficoAI;\r\n\r\n              // SE CREAN VARIABLES PARA GUARDAR LOS DATOS SOBRE LOS PUNTOS DE RECARGA QUE SE APLICARÁN EN EL FILTRO:\r\n              var listaTipoConector = [\r\n                dojo.byId(\"tipoConector1\"),\r\n                dojo.byId(\"tipoConector2\"),\r\n                dojo.byId(\"tipoConector3\"),\r\n                dojo.byId(\"tipoConector4\"),\r\n                dojo.byId(\"tipoConector5\"),\r\n                dojo.byId(\"tipoConector6\"),\r\n                dojo.byId(\"tipoConector7\"),\r\n                dojo.byId(\"tipoConector8\"),\r\n              ];\r\n\r\n              var listaTipoOperador = [\r\n                dojo.byId(\"tipoOperador1\"),\r\n                dojo.byId(\"tipoOperador2\"),\r\n                dojo.byId(\"tipoOperador3\"),\r\n                dojo.byId(\"tipoOperador4\"),\r\n                dojo.byId(\"tipoOperador5\"),\r\n                dojo.byId(\"tipoOperador6\"),\r\n                dojo.byId(\"tipoOperador7\"),\r\n                dojo.byId(\"tipoOperador8\"),\r\n              ];\r\n\r\n              // SE DEFINE LA FUNCIÓN QUE SELECCIONA TODOS LOS VALORES DE TIPO DE CONECTOR:\r\n              on(dojo.byId(\"tipoConectorTodos\"), \"change\", function(){\r\n\r\n                if (dojo.byId(\"tipoConectorTodos\").checked == true) {\r\n\r\n                  dojo.forEach(listaTipoConector, function(tipoConector){\r\n                    tipoConector.checked = true;\r\n                  });\r\n                  \r\n                  listaTipoConector.push(dojo.byId(\"tipoConectorTodos\"));\r\n                  console.log(listaTipoConector);\r\n\r\n                } else if (dojo.byId(\"tipoConectorTodos\").checked == false) {\r\n\r\n                  dojo.forEach(listaTipoConector, function(tipoConector){\r\n                    tipoConector.checked = false;\r\n                  });\r\n\r\n                  listaTipoConector.pop();\r\n                  console.log(listaTipoConector);\r\n\r\n                };\r\n\r\n              });\r\n\r\n              // SE DEFINE LA FUNCIÓN QUE SELECCIONA TODOS LOS VALORES DE TIPO DE OPERADOR:\r\n              on(dojo.byId(\"tipoOperadorTodos\"), \"change\", function(){\r\n\r\n                if (dojo.byId(\"tipoOperadorTodos\").checked == true) {\r\n                  dojo.forEach(listaTipoOperador, function(tipoOperador){\r\n                    tipoOperador.checked = true;\r\n                  });\r\n                } else if (dojo.byId(\"tipoOperadorTodos\").checked == false) {\r\n                  dojo.forEach(listaTipoOperador, function(tipoOperador){\r\n                    tipoOperador.checked = false;\r\n                  });\r\n                };\r\n\r\n              });\r\n              \r\n              // AL PULSAR EN EL BOTÓN DE BUSCAR PUNTOS DE RECARGA, SE LANZA LA CADENA DE FUNCIONES (SIEMPRE DENTRO DEL ELSE DE LA PRIMERA TAREA DE RUTA) QUE BUSCARÁN LOS PUNTOS DE RECARGA AL ALCANCE Y DENTRO DE LOS FILTROS ESPECIFICADOS:\r\n              on(dojo.byId(\"buscarPuntosRecarga\"), \"click\", function(){\r\n\r\n                miMapa.graphics.clear(graficoAI);\r\n\r\n                // SE CREAN VARIABLES PARA ALMACENAR CADENAS DE TEXTO CON LOS DATOS DE LOS FILTROS PARA CREAR UNA EXPRESIÓN DE DEFINICIÓN:\r\n\r\n                // ESTE BLOQUE DE CÓDIGO CREA LA CADENA DE TEXTO (EN SQL) CON EL FILTRO DEL TIPO DE CONECTOR:\r\n                var tipoConectorSeleccionado = [];\r\n                dojo.forEach(listaTipoConector, function(tipoConector){\r\n                  if (tipoConector.checked == true) {\r\n                    tipoConectorSeleccionado.push(tipoConector.value);\r\n                  };\r\n                });\r\n                \r\n                var expresionesTipoConector = [];\r\n                dojo.forEach(tipoConectorSeleccionado, function(conector){\r\n                  expresionesTipoConector.push(\"tipoconector = \" + conector + \" or \");\r\n                });\r\n                expresionesTipoConector.push(\"tipoconector = 27\");\r\n\r\n                var expresionDefinicionConectores = \"\";\r\n                dojo.forEach(expresionesTipoConector, function(expresion){\r\n                  expresionDefinicionConectores += expresion;\r\n                });\r\n\r\n                // ESTE BLOQUE DE CÓDIGO CREA LA CADENA DE TEXTO (EN SQL) CON EL FILTRO DEL TIPO DE OPERADOR:\r\n                var tipoOperadorSeleccionado = [];\r\n                var expresionesTipoOperador = [];\r\n                var expresionDefinicionOperadores = \"\";\r\n\r\n                if (dojo.byId(\"tipoConectorTodos\").checked != true) {\r\n\r\n                  dojo.forEach(listaTipoOperador, function(tipoOperador){\r\n                    if (tipoOperador.checked == true) {\r\n                      tipoOperadorSeleccionado.push(tipoOperador.value);\r\n                    };\r\n                  });\r\n\r\n                  dojo.forEach(tipoOperadorSeleccionado, function(operador){\r\n                    expresionesTipoOperador.push(\"operadorpromotor = '\" + operador + \"' or \");\r\n                  });\r\n                  expresionesTipoOperador.push(\"operadorpromotor = 'TEXTO DE CONTROL'\");\r\n\r\n                  dojo.forEach(expresionesTipoOperador, function(expresion){\r\n                    expresionDefinicionOperadores += expresion;\r\n                  });\r\n\r\n                };              \r\n\r\n                // SE CREA UNA GRAN CADENA DE TEXTO, SUMANDO LAS ANTERIORES, QUE SE GUARDA COMO EXPRESIÓN DE DEFINCIÓN QUE SE PASARÁ MÁS ADELANTE A LA CAPA DE PUNTOS DE RECARGA:\r\n                var expresionDefinicion = \"\";\r\n                if (dojo.byId(\"tipoConectorTodos\").checked == true) {\r\n                  expresionDefinicion = expresionDefinicionConectores;\r\n                } else {\r\n                  expresionDefinicion = (\"(\" + expresionDefinicionConectores + \") and (\" + expresionDefinicionOperadores + \")\");\r\n                };                \r\n                console.log(expresionDefinicion);\r\n\r\n\r\n\r\n                // SE PREPARAN LAS VARIABLES PARA REALIZAR UN BUFFER DESDE LA RUTA DE LA SOLUCIÓN DE LA PRIMERA TAREA DE RUTA:\r\n                var servicioGeometria = new GeometryService(\"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer\");\r\n\r\n                var parametrosAI = new BufferParameters();\r\n                parametrosAI.geometries = [rutaPrimerCaso.geometry];\r\n                parametrosAI.distances = [dojo.byId(\"distancia\").value];\r\n                parametrosAI.unit = GeometryService.UNIT_KILOMETER;\r\n                parametrosAI.outSpatialReference = miMapa.spatialReference;\r\n\r\n                // SE EJECUTA EL BUFFER Y AL COMPLETARSE SE LANZA LA SIGUIENTE CADENA DE FUNCIONES, QUE FILTRARÁN LOS PUNTOS QUE SE MUESTRAN AL USUARIO:\r\n                servicioGeometria.buffer(parametrosAI);\r\n                servicioGeometria.on(\"buffer-complete\", function(eventoBuffer){\r\n\r\n                  // SE MUESTRAN LOS PUNTOS DE RECARGA Y SE LES APLICA EL FILTRO ALMACENADO ANTERIORMENTE EN LA EXPRESION DE DEFINICIÓN:\r\n                  capaPuntosRecarga.layerObject.show();\r\n                  capaPuntosRecarga.layerObject.setDefinitionExpression(expresionDefinicion);\r\n\r\n                  // SE CENTRA EL MAPA EN EL BUFFER Y SE DIBUJA EN LA CAPA GRÁFICOS:\r\n                  miMapa.setExtent(eventoBuffer.geometries[0].getExtent(), true);\r\n\r\n                  var simboloAI = new SimpleFillSymbol(\r\n                    SimpleFillSymbol.STYLE_NULL,\r\n                    new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHED, new Color([0,0,0,0.75]), 3),\r\n                    new Color([255,0,0,0.35])\r\n                  );\r\n\r\n                  dojo.forEach(eventoBuffer.geometries, function(parametro) {\r\n                    graficoAI = new Graphic(parametro, simboloAI);\r\n                    miMapa.graphics.add(graficoAI);\r\n                  });\r\n\r\n                  // SE PREPARA UNA TAREA DE CONSULTA PARA OBTENER UNA LISTA DE LOS PUNTOS DE RECARGA QUE QUEDEN DENTRO DE LA GEOMETRÍA DEL BUFFER Y QUE CUMPLA EL FILTRO:\r\n                  var consultaPdR = new Query();\r\n                  consultaPdR.where = expresionDefinicion;\r\n                  consultaPdR.outFields = [\"*\"];\r\n                  consultaPdR.geometry = graficoAI.geometry;\r\n                  consultaPdR.returnGeometry = true;\r\n                  consultaPdR.outSpatialReference = new SpatialReference(102100);\r\n\r\n                  capaPuntosRecarga.layerObject.queryFeatures(consultaPdR);\r\n\r\n                  var miTareaDeConsulta = new QueryTask(capaPuntosRecarga.url);\r\n\r\n                  // SE EJECUTA LA TAREA DE CONSULTA Y SE LANZA LA SIGUIENTE FUNCIÓN, QUE USARÁ LOS RESULTADOS PARA EVALUAR CUALES DE LOS PUNTOS OBTENIDOS DENTRO DEL BUFFER ESTÁN AL ALCANCE DE LA AUTONOMÍA DEL COCHE:\r\n                  miTareaDeConsulta.execute(consultaPdR, function(resultado){\r\n                    \r\n                    console.log(resultado);\r\n\r\n                    // SE CREA LA VARIABLE QUE ALMACENARÁ LOS ID DE LOS PUNTOS QUE SE OBTENGAN MÁS ADELANTE:\r\n                    var indices = [];\r\n\r\n                    // SE EJECUTARÁ UNA TAREA DE RUTA DESDE EL ORIGEN HASTA CADA PUNTO OBTENIDO PARA VER SI ESTÁN DENTRO DEL RANGO DE AUTONOMÍA:\r\n                    var tareaRutaEvaluadora = new RouteTask(urlServicioRutas);\r\n\r\n                    // SE ITERA POR CADA PUNTO OBTENIDO DE LA QUERYTASK:\r\n                    dojo.forEach(resultado.features, function(entidad){\r\n\r\n                      var entidadEvaluada = entidad;\r\n                      var puntoEvaluado = new Graphic(entidad.geometry, miSimboloUbicacion);\r\n\r\n                      var entidadesRutaEvaluadora = [];\r\n                      entidadesRutaEvaluadora.push(ubicacionInicio);\r\n                      entidadesRutaEvaluadora.push(puntoEvaluado);\r\n\r\n                      var ubicacionesRutaEvaluadora = new FeatureSet();\r\n                      ubicacionesRutaEvaluadora.features = entidadesRutaEvaluadora;\r\n\r\n                      var parametrosRutaEvaluadora = new RouteParameters;\r\n                      parametrosRutaEvaluadora.accumulateAttributes = [\"ConsumoKWh\", \"Length\", \"Tiempo_coche\"];\r\n                      parametrosRutaEvaluadora.preserveFirstStop = true;\r\n                      parametrosRutaEvaluadora.preserveLastStop = true;\r\n                      parametrosRutaEvaluadora.restrictUTurns = NATypes.UTurn.AT_DEAD_ENDS_ONLY;\r\n                      parametrosRutaEvaluadora.outputLines = NATypes.OutputLine.TRUE_SHAPE_WITH_MEASURE;\r\n                      parametrosRutaEvaluadora.stops = ubicacionesRutaEvaluadora;\r\n                      parametrosRutaEvaluadora.outSpatialReference = miMapa.spatialReference;  \r\n\r\n                      // CUANDO SE RESUELVE LA RUTA SE COMPRUEBA SI EL PUNTO ESTÁ DENTRO DEL RANGO (EN KWH) Y EN CASO AFIRMATIVO SE AÑADE AL ARRAY DE INDICES:\r\n                      tareaRutaEvaluadora.solve(parametrosRutaEvaluadora, function(eventoRutaEvaluadora){\r\n\r\n                        console.log(\"eventoRutaEvaluadora\", eventoRutaEvaluadora)\r\n\r\n                        var rutaEvaluadora = eventoRutaEvaluadora.routeResults[0].route;\r\n\r\n                        if (rutaEvaluadora.attributes.Total_ConsumoKWh < (bateriaDisponible * (porcentajeDisponible/100))) {\r\n                          indices.push(entidadEvaluada.attributes.objectid);\r\n                        };\r\n\r\n                      });\r\n\r\n                    });\r\n\r\n                    // CUANDO SE COMPLETE LA RESOLUCIÓN DE CADA RUTA EVALUADA, SE CREARÁ UNA CADENA DE TEXTO PARA CADA PUNTO, LAS CUALES SE UNIRÁN Y SE AÑADIRÁN A LA EXPRESIÓN DE DEFINICIÓN:\r\n                    tareaRutaEvaluadora.on(\"solve-complete\", function(eventoRutaEvaluadora){\r\n\r\n                      var expresiones = [];\r\n\r\n                      dojo.forEach(indices, function(idPunto){\r\n                        expresiones.push(\"objectid = \" + idPunto + \" or \");\r\n                      });\r\n\r\n                      expresiones.push(\"objectid = 0\");\r\n\r\n                      var expresionDefinicionGeometria = [];\r\n\r\n                      dojo.forEach(expresiones, function(expresion){\r\n                        expresionDefinicionGeometria += expresion;\r\n                      });\r\n\r\n                      expresionDefinicion = (\"(\" + expresionDefinicionGeometria + \") and (\" + expresionDefinicionConectores + \") and (\" + expresionDefinicionOperadores + \")\");\r\n                      console.log(\"La expresión: \", expresionDefinicion);\r\n\r\n                      capaPuntosRecarga.layerObject.setDefinitionExpression(expresionDefinicion);\r\n\r\n                      // UNA VEZ COMPLETADA LA EVALUACIÓN DE LOS PUNTOS, SE DESBLOQUEA EL TERCER BLOQUE HTML, QUE PERMITE SELECCIONAR UNO DE LOS PUNTOS FILTRADOS:\r\n                      dojo.byId(\"datosTercerCaso\").style.display = \"block\";\r\n\r\n                    });\r\n\r\n                    miMapa.graphics.clear(graficoAI);\r\n\r\n                  });\r\n\r\n                });\r\n\r\n              });\r\n\r\n              // AL PULSAR EN EL BOTÓN DE SELECCIONAR PUNTO (DEL TERCER BLOQUE) SE LANZA LA FUNCIÓN QUE PERMITE SELECCIONAR UNO DE LOS PUNTOS MOSTRADOS:\r\n              on(dojo.byId(\"seleccionarPunto\"), \"click\", function(){\r\n\r\n                var herramientaSeleccion = new Draw(miMapa);\r\n\r\n                herramientaSeleccion.activate(Draw.EXTENT);\r\n                herramientaSeleccion.on(\"draw-end\", function(eventoSeleccion){\r\n\r\n                  var consultaSeleccion = new Query();\r\n                  consultaSeleccion.geometry = eventoSeleccion.geometry;\r\n\r\n                  var simboloSeleccion = new SimpleMarkerSymbol(\r\n                    SimpleMarkerSymbol.STYLE_SQUARE, \r\n                    10,\r\n                    new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n                    new Color([255,0,0])\r\n                  );\r\n\r\n                  capaPuntosRecarga.layerObject.setSelectionSymbol(simboloSeleccion);\r\n                  capaPuntosRecarga.layerObject.selectFeatures(consultaSeleccion);\r\n\r\n                  herramientaSeleccion.deactivate();\r\n\r\n                });\r\n\r\n              });\r\n\r\n              // AL PULSAR EN RECALCULAR RUTA SE VUELVE A EVALUAR LA RUTA ENTRE EL ORIGEN Y EL DESTINO, PERO METIENDO ESTA VEZ EL PUNTO DE CARGA (O PUNTOS) SELECCIONADO COMO UBICACIÓN INTERMEDIA:\r\n              on(dojo.byId(\"recalcularRuta\"), \"click\", function(){\r\n\r\n                miMapa.graphics.clear(graficoAI);\r\n\r\n                var puntoSeleccionado = capaPuntosRecarga.layerObject.getSelectedFeatures();\r\n                console.log(puntoSeleccionado);\r\n\r\n                if (puntoSeleccionado.length == 0){\r\n                  dojo.byId(\"errorPunto\").innerHTML = \"Es necesario que seleccione un punto donde recargar.\";\r\n                  return;\r\n                };\r\n                \r\n                var miSimboloUbicacion = new SimpleMarkerSymbol(\r\n                  SimpleMarkerSymbol.STYLE_SQUARE, \r\n                  10,\r\n                  new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n                  new Color([255,255,255])\r\n                );\r\n\r\n                var entidadesSegundaRuta = [];\r\n                \r\n                // SE METE AL ARRAY DE ENTIDADES PARA LA RUTA EL MISMO PUNTO DE ORIGEN QUE SE MARCÓ AL INICIO:\r\n                entidadesSegundaRuta.push(ubicacionInicio);\r\n                miMapa.graphics.add(ubicacionInicio);\r\n\r\n                // SE EVALUA SI SON 1, 2 O 3 LOS PUNTOS SELECCIONADOS QUE HAY QUE METER AL ARRAY DE ENTIDADES PARA LA RUTA, Y SE COLOCAN DETRÁS DEL INICIO:\r\n                if (puntoSeleccionado.length == 1) {\r\n\r\n                  var ubicacionIntermedia = new Graphic(puntoSeleccionado[0].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia);\r\n                  miMapa.graphics.add(ubicacionIntermedia);\r\n\r\n                } else if (puntoSeleccionado.length == 2) {\r\n\r\n                  var ubicacionIntermedia1 = new Graphic(puntoSeleccionado[0].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia1);\r\n                  miMapa.graphics.add(ubicacionIntermedia1);\r\n                  var ubicacionIntermedia2 = new Graphic(puntoSeleccionado[1].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia2);\r\n                  miMapa.graphics.add(ubicacionIntermedia2);\r\n\r\n                } else if (puntoSeleccionado.length == 3) {\r\n\r\n                  var ubicacionIntermedia1 = new Graphic(puntoSeleccionado[0].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia1);\r\n                  miMapa.graphics.add(ubicacionIntermedia1);\r\n                  var ubicacionIntermedia2 = new Graphic(puntoSeleccionado[1].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia2);\r\n                  miMapa.graphics.add(ubicacionIntermedia2);\r\n                  var ubicacionIntermedia3 = new Graphic(puntoSeleccionado[2].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia3);\r\n                  miMapa.graphics.add(ubicacionIntermedia3);\r\n\r\n                } else {\r\n                  dojo.byId(\"errorPunto\").innerHTML = \"Seleccione 3 o menos puntos únicamente.\";\r\n                  return;\r\n                };\r\n\r\n                // SE METE AL FINAL DEL ARRAY DE ENTIDADES PARA LA RUTA EL MISMO PUNTO DE DESTINO QUE SE MARCÓ AL INICIO:\r\n                entidadesSegundaRuta.push(ubicacionFinal);\r\n                miMapa.graphics.add(ubicacionFinal);\r\n\r\n                // SE PREPARAN LOS PARAMÉTROS PARA VOLVER A RESOLVER LA RUTA:\r\n                var ubicacionesSegundaRuta = new FeatureSet();\r\n                ubicacionesSegundaRuta.features = entidadesSegundaRuta;\r\n\r\n                var tareaSegundaRuta = new RouteTask(urlServicioRutas);\r\n\r\n                var parametrosSegundaRuta = new RouteParameters;\r\n                parametrosSegundaRuta.accumulateAttributes = [\"ConsumoKWh\", \"Length\", \"Tiempo_coche\"];\r\n                parametrosSegundaRuta.preserveFirstStop = true;\r\n                parametrosSegundaRuta.preserveLastStop = true;\r\n                parametrosSegundaRuta.restrictUTurns = NATypes.UTurn.AT_DEAD_ENDS_ONLY;\r\n                parametrosSegundaRuta.outputLines = NATypes.OutputLine.TRUE_SHAPE_WITH_MEASURE;\r\n                parametrosSegundaRuta.stops = ubicacionesSegundaRuta;\r\n                parametrosSegundaRuta.outSpatialReference = miMapa.spatialReference;\r\n                \r\n                // SE RESUELVE LA TAREA DE RUTA Y SE DIBUJAN LOS RESULTADOS EN EL MAPA Y LOS DATOS DEL VIAJE SE ESCRIBEN EN EL HTML:\r\n                tareaSegundaRuta.solve(parametrosSegundaRuta, function(evento){\r\n\r\n                  var rutaSegundoCaso = evento.routeResults[0].route;\r\n                  var simboloRuta = new SimpleLineSymbol(\"solid\", new Color([0,255,0]), 3);\r\n\r\n                  rutaSegundoCaso.setSymbol(simboloRuta);\r\n                  miMapa.graphics.add(rutaSegundoCaso);\r\n                  miMapa.setExtent(rutaSegundoCaso.geometry.getExtent(), true);\r\n\r\n                  dojo.byId(\"consumoTotal\").innerHTML = \"El consumo total del trayecto será \" + Math.round((rutaSegundoCaso.attributes.Total_ConsumoKWh)*100)/100 + \"kWh.\";\r\n                  dojo.byId(\"trayectoTotal\").innerHTML = \"El trayecto recorrerá \" + Math.round((rutaSegundoCaso.attributes.Total_Length/1000)*100)/100 + \"km en \" + Math.round((rutaSegundoCaso.attributes.Total_Tiempo_coche)*100)/100 + \"horas.\";\r\n\r\n                });\r\n\r\n              }); \r\n\r\n            };\r\n\r\n            puntoInicio = null;\r\n            puntoFinal = null;\r\n\r\n          });\r\n\r\n          dojo.byId(\"errorUbicacion\").innerHTML = \"\";\r\n\r\n        } else {\r\n          dojo.byId(\"errorUbicacion\").innerHTML = \"Seleccione un punto inicial y un punto final para calcular la ruta.\";\r\n          return;\r\n        };\r\n\r\n      });\r\n\r\n    },\r\n\r\n    onClose: function(){\r\n\r\n      console.log('PFM_Ruta::onClose');\r\n      // this.map.graphics.clear();\r\n      this.map.itemInfo.itemData.operationalLayers[0].layerObject.setDefinitionExpression(null);\r\n      this.bateria.value = 0;\r\n      dojo.byId(\"datosSegundoCaso\").style.display = \"none\";\r\n      dojo.byId(\"datosTercerCaso\").style.display = \"none\";\r\n      dojo.byId(\"consumoTotal\").innerHTML = \"\";\r\n      dojo.byId(\"trayectoTotal\").innerHTML = \"\";\r\n      this.map.itemInfo.itemData.operationalLayers[0].layerObject.clearSelection();\r\n      \r\n    },\r\n\r\n    // onMinimize: function(){\r\n    //   console.log('PFM_Ruta::onMinimize');\r\n    // },\r\n\r\n    // onMaximize: function(){\r\n    //   console.log('PFM_Ruta::onMaximize');\r\n    // },\r\n\r\n    // onSignIn: function(credential){\r\n    //   console.log('PFM_Ruta::onSignIn', credential);\r\n    // },\r\n\r\n    // onSignOut: function(){\r\n    //   console.log('PFM_Ruta::onSignOut');\r\n    // }\r\n\r\n    // onPositionChange: function(){\r\n    //   console.log('PFM_Ruta::onPositionChange');\r\n    // },\r\n\r\n    // resize: function(){\r\n    //   console.log('PFM_Ruta::resize');\r\n    // }\r\n\r\n    //methods to communication between widgets:\r\n\r\n  });\r\n\r\n});\r\n"]}