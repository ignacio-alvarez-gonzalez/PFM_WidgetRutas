{"version":3,"sources":["../../../widgets/PFM_Ruta/Widget_versionAnterior_1.js"],"names":["define","declare","BaseWidget","SpatialReference","FeatureSet","FeatureLayer","RouteTask","RouteParameters","RouteResult","NATypes","GeometryService","BufferParameters","QueryTask","Query","Draw","Point","SimpleFillSymbol","SimpleLineSymbol","SimpleMarkerSymbol","Graphic","Color","on","baseClass","postCreate","inherited","arguments","console","log","onOpen","miMapa","map","capaPuntosRecarga","itemInfo","itemData","operationalLayers","puntoInicio","ubicacionInicio","puntoFinal","ubicacionFinal","graphics","clear","dojo","byId","remove","herramientaDibujo","activate","POINT","evento","geometry","miSimboloUbicacion","STYLE_SQUARE","STYLE_SOLID","add","deactivate","value","innerHTML","entidades","push","ubicaciones","features","tareaRuta","parametrosRuta","accumulateAttributes","preserveFirstStop","preserveLastStop","restrictUTurns","UTurn","AT_DEAD_ENDS_ONLY","outputLines","OutputLine","TRUE_SHAPE_WITH_MEASURE","stops","outSpatialReference","spatialReference","solve","rutaPrimerCaso","routeResults","route","simboloRuta","attributes","Total_ConsumoKWh","setSymbol","setExtent","getExtent","Math","round","Total_Length","Total_Tiempo_coche","style","visibility","servicioGeometria","parametrosAI","geometries","distances","unit","UNIT_KILOMETER","buffer","eventoBuffer","simboloAI","STYLE_NULL","graficoAI","forEach","parametro","consultaPdR","where","outFields","returnGeometry","layerObject","queryFeatures","miTareaDeConsulta","url","executeForIds","resultado","expresiones","idPunto","expresionDefinicion","expresion","setDefinitionExpression","herramientaSeleccion","EXTENT","eventoSeleccion","consultaSeleccion","simboloSeleccion","setSelectionSymbol","selectFeatures","puntoSeleccionado","getSelectedFeatures","length","entidadesSegundaRuta","ubicacionIntermedia","ubicacionIntermedia1","ubicacionIntermedia2","ubicacionIntermedia3","ubicacionesSegundaRuta","tareaSegundaRuta","parametrosSegundaRuta","rutaSegundoCaso","onClose","bateria","clearSelection"],"mappings":"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","file":"Widget_versionAnterior_1.js","sourcesContent":["define([\r\n  'dojo/_base/declare',\r\n  'jimu/BaseWidget',\r\n\r\n  \"esri/SpatialReference\",\r\n  \"esri/tasks/FeatureSet\",\r\n  \"esri/layers/FeatureLayer\",\r\n\r\n  \"esri/tasks/RouteTask\",\r\n  \"esri/tasks/RouteParameters\",\r\n  \"esri/tasks/RouteResult\",\r\n  \"esri/tasks/NATypes\",\r\n\r\n  \"esri/tasks/GeometryService\",\r\n  \"esri/tasks/BufferParameters\",\r\n\r\n  \"esri/tasks/QueryTask\",\r\n  \"esri/tasks/query\",\r\n\r\n  \"esri/toolbars/draw\",\r\n  \"esri/geometry/Point\",\r\n  \"esri/symbols/SimpleFillSymbol\",\r\n  \"esri/symbols/SimpleLineSymbol\",\r\n  \"esri/symbols/SimpleMarkerSymbol\",\r\n  \"esri/graphic\", \r\n  \"esri/Color\",\r\n\r\n  \"dojo/on\"\r\n], function(\r\n  declare, \r\n  BaseWidget,\r\n\r\n  SpatialReference,\r\n  FeatureSet,\r\n  FeatureLayer,\r\n\r\n  RouteTask,\r\n  RouteParameters,\r\n  RouteResult,\r\n  NATypes,\r\n\r\n  GeometryService,\r\n  BufferParameters,\r\n\r\n  QueryTask,\r\n  Query,\r\n\r\n  Draw,\r\n  Point,\r\n  SimpleFillSymbol,\r\n  SimpleLineSymbol,\r\n  SimpleMarkerSymbol,\r\n  Graphic,\r\n  Color,\r\n\r\n  on\r\n  ) {\r\n\r\n  return declare([BaseWidget], {\r\n\r\n    baseClass: 'pfm-ruta',\r\n\r\n    postCreate: function() {\r\n      this.inherited(arguments);\r\n      console.log('PFM_Ruta::postCreate');\r\n    },\r\n\r\n    // startup: function() {\r\n    //   this.inherited(arguments);\r\n    //   console.log('PFM_Ruta::startup');\r\n    // },\r\n\r\n    onOpen: function(){\r\n      console.log('PFM_Ruta::onOpen');\r\n\r\n      var miMapa = this.map;\r\n\r\n      var capaPuntosRecarga = this.map.itemInfo.itemData.operationalLayers[0];\r\n\r\n      var puntoInicio;\r\n      var ubicacionInicio;\r\n      var puntoFinal;\r\n      var ubicacionFinal;\r\n\r\n      miMapa.graphics.clear();\r\n\r\n      on(dojo.byId(\"seleccionInicio\"), \"click\", function(){\r\n\r\n        miMapa.graphics.remove(ubicacionInicio);\r\n\r\n        var herramientaDibujo = new Draw(miMapa);\r\n        herramientaDibujo.activate(Draw.POINT);\r\n        herramientaDibujo.on(\"draw-end\", function(evento){\r\n\r\n          puntoInicio = new Point(evento.geometry);\r\n\r\n          var miSimboloUbicacion = new SimpleMarkerSymbol(\r\n            SimpleMarkerSymbol.STYLE_SQUARE, \r\n            10,\r\n            new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n            new Color([255,255,255])\r\n          );\r\n\r\n          ubicacionInicio = new Graphic(puntoInicio, miSimboloUbicacion);\r\n          miMapa.graphics.add(ubicacionInicio);\r\n\r\n          herramientaDibujo.deactivate();\r\n\r\n        });\r\n\r\n      });\r\n\r\n      on(dojo.byId(\"seleccionFinal\"), \"click\", function(){\r\n\r\n        miMapa.graphics.remove(ubicacionFinal);\r\n\r\n        var herramientaDibujo = new Draw(miMapa);\r\n        herramientaDibujo.activate(Draw.POINT);\r\n        herramientaDibujo.on(\"draw-end\", function(evento){\r\n\r\n          puntoFinal = new Point(evento.geometry);\r\n\r\n          var miSimboloUbicacion = new SimpleMarkerSymbol(\r\n            SimpleMarkerSymbol.STYLE_SQUARE, \r\n            10,\r\n            new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n            new Color([255,255,255])\r\n          );\r\n\r\n          ubicacionFinal = new Graphic(puntoFinal, miSimboloUbicacion);\r\n          miMapa.graphics.add(ubicacionFinal);\r\n\r\n          herramientaDibujo.deactivate();\r\n\r\n        });\r\n\r\n      });\r\n\r\n      on(dojo.byId(\"calcularRuta\"), \"click\", function(){\r\n\r\n        if (dojo.byId(\"bateria\").value == 0) {\r\n          dojo.byId(\"errorUbicacion\").innerHTML = \"Introduzca la capacidad de su batería\";\r\n          return;\r\n        };\r\n\r\n        if ((puntoInicio != null) && (puntoFinal != null)) {\r\n\r\n          var entidades = [];\r\n          entidades.push(ubicacionInicio);\r\n          entidades.push(ubicacionFinal);\r\n\r\n          var ubicaciones = new FeatureSet();\r\n          ubicaciones.features = entidades;\r\n\r\n          var tareaRuta = new RouteTask(\"https://localhost:6443/arcgis/rest/services/PFM/20210403_pruebaPublicarServiciosRutas_v2/NAServer/Route\");\r\n\r\n          var parametrosRuta = new RouteParameters;\r\n          parametrosRuta.accumulateAttributes = [\"ConsumoKWh\", \"Length\", \"Tiempo_coche\"];\r\n          parametrosRuta.preserveFirstStop = true;\r\n          parametrosRuta.preserveLastStop = true;\r\n          parametrosRuta.restrictUTurns = NATypes.UTurn.AT_DEAD_ENDS_ONLY;\r\n          parametrosRuta.outputLines = NATypes.OutputLine.TRUE_SHAPE_WITH_MEASURE;\r\n          parametrosRuta.stops = ubicaciones;\r\n          parametrosRuta.outSpatialReference = miMapa.spatialReference;\r\n\r\n          tareaRuta.solve(parametrosRuta, function(evento){\r\n\r\n            console.log(\"Resultados de la ruta: \", evento);\r\n            var rutaPrimerCaso = evento.routeResults[0].route;\r\n            var simboloRuta = new SimpleLineSymbol(\"solid\", new Color([255,127,0]), 3);\r\n\r\n            if (rutaPrimerCaso.attributes.Total_ConsumoKWh < dojo.byId(\"bateria\").value) {\r\n\r\n              rutaPrimerCaso.setSymbol(simboloRuta);\r\n              miMapa.graphics.add(rutaPrimerCaso);\r\n              miMapa.setExtent(rutaPrimerCaso.geometry.getExtent(), true);\r\n              dojo.byId(\"consumoTotal\").innerHTML = \"El consumo total del trayecto será \" + Math.round((rutaPrimerCaso.attributes.Total_ConsumoKWh)*100)/100 + \"kWh.\";\r\n              dojo.byId(\"trayectoTotal\").innerHTML = \"El trayecto recorrerá \" + Math.round((rutaPrimerCaso.attributes.Total_Length/1000)*100)/100 + \"km en \" + Math.round((rutaPrimerCaso.attributes.Total_Tiempo_coche)*100)/100 + \"horas.\";\r\n\r\n            } else {\r\n\r\n              dojo.byId(\"datosSegundoCaso\").style.visibility = \"visible\";\r\n\r\n              on(dojo.byId(\"buscarPuntosRecarga\"), \"click\", function(){\r\n\r\n                var servicioGeometria = new GeometryService(\"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer\");\r\n\r\n                var parametrosAI = new BufferParameters();\r\n                parametrosAI.geometries = [rutaPrimerCaso.geometry];\r\n                parametrosAI.distances = [dojo.byId(\"distancia\").value];\r\n                parametrosAI.unit = GeometryService.UNIT_KILOMETER;\r\n                parametrosAI.outSpatialReference = miMapa.spatialReference;\r\n\r\n                servicioGeometria.buffer(parametrosAI);\r\n                servicioGeometria.on(\"buffer-complete\", function(eventoBuffer){\r\n\r\n                  miMapa.setExtent(eventoBuffer.geometries[0].getExtent(), true);\r\n\r\n                  var simboloAI = new SimpleFillSymbol(\r\n                    SimpleFillSymbol.STYLE_NULL,\r\n                    new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([255,0,0,0.65]), 3),\r\n                    new Color([255,0,0,0.35])\r\n                  );\r\n                  \r\n                  var graficoAI;\r\n\r\n                  dojo.forEach(eventoBuffer.geometries, function(parametro) {\r\n                    graficoAI = new Graphic(parametro, simboloAI);\r\n                    miMapa.graphics.add(graficoAI);\r\n                  });\r\n\r\n                  console.log(graficoAI);\r\n\r\n                  var consultaPdR = new Query();\r\n                  consultaPdR.where = \"1=1\";\r\n                  consultaPdR.outFields = [\"*\"];\r\n                  consultaPdR.geometry = graficoAI.geometry;\r\n                  consultaPdR.returnGeometry = true;\r\n                  consultaPdR.outSpatialReference = new SpatialReference(102100);\r\n\r\n                  capaPuntosRecarga.layerObject.queryFeatures(consultaPdR);\r\n\r\n                  var miTareaDeConsulta = new QueryTask(capaPuntosRecarga.url);\r\n                  miTareaDeConsulta.executeForIds(consultaPdR, function(resultado){\r\n\r\n                    console.log(\"El mapa: \", miMapa),\r\n                    console.log(\"Resultados de la consulta: \", resultado);\r\n\r\n                    var expresiones = [];\r\n\r\n                    dojo.forEach(resultado, function(idPunto){\r\n                      // capaPuntosRecarga.layerObject.setDefinitionExpression(\"objectid = \" + [idPunto]);\r\n                      expresiones.push(\"objectid = \" + [idPunto] + \" or \");\r\n                    });\r\n\r\n                    expresiones.push(\"objectid = 0\");\r\n\r\n                    var expresionDefinicion = [];\r\n\r\n                    dojo.forEach(expresiones, function(expresion){\r\n                      expresionDefinicion += expresion\r\n                    });\r\n                    \r\n                    console.log(expresionDefinicion);\r\n                    capaPuntosRecarga.layerObject.setDefinitionExpression(expresionDefinicion);\r\n\r\n                    // capaPuntosRecarga.layerObject.setDefinitionExpression(\"objectid = 1 or objectiid = 2\");\r\n                    // capaPuntosRecarga.layerObject.setDefinitionExpression(\"objectid = 'B:SM Serveis Municipals'\");\r\n\r\n                  });\r\n                  miTareaDeConsulta.on(\"execute-for-ids-complete\", function(){\r\n                    dojo.byId(\"datosTercerCaso\").style.visibility = \"visible\";\r\n                  });\r\n\r\n                });\r\n\r\n              });\r\n\r\n              var herramientaSeleccion = new Draw(miMapa);\r\n\r\n              on(dojo.byId(\"seleccionarPunto\"), function(){\r\n\r\n                herramientaSeleccion.activate(Draw.EXTENT);\r\n                herramientaSeleccion.on(\"draw-end\", function(eventoSeleccion){\r\n\r\n                  var consultaSeleccion = new Query();\r\n                  consultaSeleccion.geometry = eventoSeleccion.geometry;\r\n\r\n                  var simboloSeleccion = new SimpleMarkerSymbol(\r\n                    SimpleMarkerSymbol.STYLE_SQUARE, \r\n                    10,\r\n                    new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n                    new Color([255,0,0])\r\n                  );\r\n\r\n                  capaPuntosRecarga.layerObject.setSelectionSymbol(simboloSeleccion);\r\n                  capaPuntosRecarga.layerObject.selectFeatures(consultaSeleccion);\r\n\r\n                });\r\n\r\n              });\r\n\r\n              on(dojo.byId(\"recalcularRuta\"), \"click\", function(){\r\n\r\n                herramientaSeleccion.deactivate();\r\n\r\n                var puntoSeleccionado = capaPuntosRecarga.layerObject.getSelectedFeatures();\r\n                console.log(puntoSeleccionado);\r\n\r\n                if (puntoSeleccionado.length == 0){\r\n                  dojo.byId(\"errorPunto\").innerHTML = \"Es necesario que seleccione un punto donde recargar.\";\r\n                  return;\r\n                };\r\n\r\n                var entidadesSegundaRuta = [];\r\n                \r\n                var miSimboloUbicacion = new SimpleMarkerSymbol(\r\n                  SimpleMarkerSymbol.STYLE_SQUARE, \r\n                  10,\r\n                  new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n                  new Color([255,255,255])\r\n                );\r\n\r\n                entidadesSegundaRuta.push(ubicacionInicio);\r\n\r\n                if (puntoSeleccionado.length == 1) {\r\n                  var ubicacionIntermedia = new Graphic(puntoSeleccionado[0].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia);\r\n                } else if (puntoSeleccionado.length == 2) {\r\n                  var ubicacionIntermedia1 = new Graphic(puntoSeleccionado[0].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia1);\r\n                  var ubicacionIntermedia2 = new Graphic(puntoSeleccionado[1].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia2);\r\n                } else if (puntoSeleccionado.length == 3) {\r\n                  var ubicacionIntermedia1 = new Graphic(puntoSeleccionado[0].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia1);\r\n                  var ubicacionIntermedia2 = new Graphic(puntoSeleccionado[1].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia2);\r\n                  var ubicacionIntermedia3 = new Graphic(puntoSeleccionado[2].geometry, miSimboloUbicacion);\r\n                  entidadesSegundaRuta.push(ubicacionIntermedia3);\r\n                } else {\r\n                  dojo.byId(\"errorPunto\").innerHTML = \"Seleccione 3 o menos puntos únicamente.\";\r\n                  return;\r\n                };\r\n\r\n                entidadesSegundaRuta.push(ubicacionFinal);\r\n\r\n                var ubicacionesSegundaRuta = new FeatureSet();\r\n                ubicacionesSegundaRuta.features = entidadesSegundaRuta;\r\n\r\n                var tareaSegundaRuta = new RouteTask(\"https://localhost:6443/arcgis/rest/services/PFM/20210403_pruebaPublicarServiciosRutas_v2/NAServer/Route\");\r\n\r\n                var parametrosSegundaRuta = new RouteParameters;\r\n                parametrosSegundaRuta.accumulateAttributes = [\"ConsumoKWh\", \"Length\", \"Tiempo_coche\"];\r\n                parametrosSegundaRuta.preserveFirstStop = true;\r\n                parametrosSegundaRuta.preserveLastStop = true;\r\n                parametrosSegundaRuta.restrictUTurns = NATypes.UTurn.AT_DEAD_ENDS_ONLY;\r\n                parametrosSegundaRuta.outputLines = NATypes.OutputLine.TRUE_SHAPE_WITH_MEASURE;\r\n                parametrosSegundaRuta.stops = ubicacionesSegundaRuta;\r\n                parametrosSegundaRuta.outSpatialReference = miMapa.spatialReference;\r\n                \r\n                tareaSegundaRuta.solve(parametrosSegundaRuta, function(evento){\r\n\r\n                  var rutaSegundoCaso = evento.routeResults[0].route;\r\n                  var simboloRuta = new SimpleLineSymbol(\"solid\", new Color([255,127,0]), 3);\r\n\r\n                  rutaSegundoCaso.setSymbol(simboloRuta);\r\n                  miMapa.graphics.add(rutaSegundoCaso);\r\n                  miMapa.setExtent(rutaSegundoCaso.geometry.getExtent(), true);\r\n\r\n                  dojo.byId(\"consumoTotal\").innerHTML = \"El consumo total del trayecto será \" + Math.round((rutaSegundoCaso.attributes.Total_ConsumoKWh)*100)/100 + \"kWh.\";\r\n                  dojo.byId(\"trayectoTotal\").innerHTML = \"El trayecto recorrerá \" + Math.round((rutaSegundoCaso.attributes.Total_Length/1000)*100)/100 + \"km en \" + Math.round((rutaSegundoCaso.attributes.Total_Tiempo_coche)*100)/100 + \"horas.\";\r\n\r\n                });\r\n\r\n              }); \r\n\r\n            };\r\n\r\n            puntoInicio = null;\r\n            puntoFinal = null;\r\n\r\n          });\r\n\r\n          dojo.byId(\"errorUbicacion\").innerHTML = \"\";\r\n\r\n        } else {\r\n          dojo.byId(\"errorUbicacion\").innerHTML = \"Seleccione un punto inicial y un punto final para calcular la ruta.\";\r\n          return;\r\n        };\r\n\r\n      });\r\n\r\n    },\r\n\r\n    onClose: function(){\r\n\r\n      console.log('PFM_Ruta::onClose');\r\n      // this.map.graphics.clear();\r\n      this.map.itemInfo.itemData.operationalLayers[0].layerObject.setDefinitionExpression(null);\r\n      this.bateria.value = 0;\r\n      dojo.byId(\"datosSegundoCaso\").style.visibility = \"hidden\";\r\n      dojo.byId(\"datosTercerCaso\").style.visibility = \"hidden\";\r\n      this.map.itemInfo.itemData.operationalLayers[0].layerObject.clearSelection();\r\n      \r\n    },\r\n\r\n    // onMinimize: function(){\r\n    //   console.log('PFM_Ruta::onMinimize');\r\n    // },\r\n\r\n    // onMaximize: function(){\r\n    //   console.log('PFM_Ruta::onMaximize');\r\n    // },\r\n\r\n    // onSignIn: function(credential){\r\n    //   console.log('PFM_Ruta::onSignIn', credential);\r\n    // },\r\n\r\n    // onSignOut: function(){\r\n    //   console.log('PFM_Ruta::onSignOut');\r\n    // }\r\n\r\n    // onPositionChange: function(){\r\n    //   console.log('PFM_Ruta::onPositionChange');\r\n    // },\r\n\r\n    // resize: function(){\r\n    //   console.log('PFM_Ruta::resize');\r\n    // }\r\n\r\n    //methods to communication between widgets:\r\n\r\n  });\r\n\r\n});\r\n"]}